# Safari (Local, via Safari Web Extension)

Safari requires wrapping the web extension in a small macOS app (generated by Apple’s converter).

## First-time setup (generate Xcode project)

```bash
bun run safari:sync
bun run safari:init
```

This creates a local Xcode project under `.safari/xcode` (ignored by git).

## Build (and rebuild after changes)

```bash
bun run safari:dev
```

That command:
- Builds `extension/dist/*`
- Syncs a Safari-safe web extension source (excluding `extension/signed/`)
- Builds the macOS app via `xcodebuild`

The output prints the built `.app` path. Open that app once, then in Safari go to `Safari -> Settings -> Extensions` and enable the extension.

## Signing it so it persists across Safari restarts

If the wrapper app / extension is only **ad-hoc signed**, Safari may disable it after restarts. The “set it once and forget it” approach is:

1. Sign in to Xcode with a free Apple Developer account (Xcode -> Settings -> Accounts)
2. Open the generated project under `.safari/xcode`
3. For **both** the app target and the extension target:
   - Set your **Team**
   - Enable **Automatically manage signing**
4. `Product -> Archive`
5. `Distribute App -> Custom -> Copy App`, export it, then run the exported `.app` once

After that, keep the exported host `.app` installed (e.g. in `/Applications`). The extension should remain available across Safari restarts.

Optional (command line): `bun run safari:archive` exports a signed `.app` under `.safari/export` (requires Xcode to be signed-in and able to fetch/create provisioning profiles).

## Updating after code changes

Changing `extension/dist/*` requires rebuilding and updating the installed host `.app`:
- If you’re using the “Copy App” export: re-archive + re-export, then replace the `.app` in `/Applications` and run it once.
- If you’re using `bun run safari:archive`: rerun it, then replace your installed `.app` with the newly exported one and run it once.

Safari usually keeps the extension enabled across updates as long as the bundle id stays the same and the host app remains installed.

## Customizing the generated app

You can override the default app name / bundle id:

```bash
SAFARI_APP_NAME="Fantasy Basketball Automation" SAFARI_BUNDLE_ID_PREFIX="com.yourname" bun run safari:dev
```


